<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基于vue reactivity的 webcomponent框架</title>
    <script src="/assets/eval5.min.js"></script>
    <!-- <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
    <script>
        // VConsole will be exported to `window.VConsole` by default.
        var vConsole = new window.VConsole();
    </script> -->

    <style>
        html {
            height: 100%;
        }

        body {
            height: 100%;
            margin: 0;
        }

        #routerroot {
            overflow: auto;
        }

        #nav {
            position: sticky;
            top: 0;
        }
    </style>
    <link rel="stylesheet" href="/assets/webelef/webele_b40e9c42.css" />
<link rel="stylesheet" href="/assets/uno.css" />
</head>

<body>
    <div id="routerroot" class="h-full"></div>
    <div id="app"></div>
    <script type="importmap">
        {
          "imports": {"vue":"https://cdn.bootcdn.net/ajax/libs/vue/3.2.47/vue.esm-browser.js","wle":"/assets/webelef/main_esm_4dd1a155.js?v=1692445667471"}
        }
    </script>
    <script type="module" src="/assets/ele/elastic-textarea.js?v=1.0.7"></script>
    <script type="module">
        import * as Vue from "vue";
        // console.dir(Vue)
        let vueapp = Vue.createApp({});
        vueapp.config.devtools = true;
        let VueDemi = (function () {
            var _VueDemi = {}
            for (var key in Vue) {
                _VueDemi[key] = Vue[key]
            }
            _VueDemi.isVue2 = false
            _VueDemi.isVue3 = true
            _VueDemi.install = function () { }
            _VueDemi.Vue = Vue
            _VueDemi.Vue2 = undefined
            _VueDemi.version = Vue.version
            _VueDemi.set = function (target, key, val) {
                if (Array.isArray(target)) {
                    target.length = Math.max(target.length, key)
                    target.splice(key, 1, val)
                    return val
                }
                target[key] = val
                return val
            }
            _VueDemi.del = function (target, key) {
                if (Array.isArray(target)) {
                    target.splice(key, 1)
                    return
                }
                delete target[key]
            }
            return _VueDemi
        })();
        globalThis.VueDemi = VueDemi;

        let s = document.createElement('script');
        s.src = 'https://cdn.bootcdn.net/ajax/libs/pinia/2.0.35/pinia.iife.js';
        document.body.appendChild(s);


        import '/assets/ele/index.js?v=0.0.10';
        import { routerModule } from '/assets/wle-router.js?v=0.0.3'

        import { reactive, onMounted, computed, watchEffect, ref, watch } from "vue"
        import { Nid, g, hc2, ForEach, Column, Text, BaseVmControl, injectControl, useControl, getAllComments, getcustomComponents } from "wle";

        window.getAllComments = getAllComments;


        let rooterRootEle = document.getElementById("routerroot")

        let BaseDir = '/assets/'
        const routes = {
            ['']: (params) => {
                return import(BaseDir + 'webele/main.js?v=' + Date.now())
            },
            404: (params) => {
                return import(BaseDir + 'webele/404.js?v=' + Date.now())
            },
            detail: (params) => {
                return import(BaseDir + 'webele/detail.js?v=' + Date.now())
            },
        };


        let keepLives = [
            '404'
        ]

        class AppCotnrol extends BaseVmControl {
            title = ''
            get TextDetail() {
                return 'detail 页面 ' + this.title
            }
            get navs() {
                return [
                    ['', {
                        label: 'main'
                    }],
                    ['detail', {
                        label: 'detail'
                    }]
                ]
            }
            setTitle(v) {
                this.title = v
            }
            action(e) {
                globalThis.wRoute.back()
            }
        }

        injectControl('app')(AppCotnrol);
        let app = useControl('app');

        window.getApp = function () {
            return {
                $vm: app
            }
        }

        let option = {
            rooterRootEle,
            routes,
            pageBeforeRender,
            keepLives,
        }

        /**
         *@param rooterRootEle {Element} 
         */
        function pageBeforeRender(rooterRootEle) {

            rooterRootEle.classList.add('dis-flex');
            rooterRootEle.style.setProperty('--app-nav-w', '90px');

            let nav = document.createElement('div')
            nav.id = 'nav'
            let dom = document.createElement('div')
            dom.innerHTML = '切换主题'
            dom.onclick = function () {
                document.documentElement.classList.toggle('theme-dark')
            }
            nav.style.width = 'var(--app-nav-w)'
            nav.appendChild(dom);

            hc2(ForEach, {
                args: [{ list: app.navs }], init: (ele, option) => {

                    let name = option.item[0];
                    let label = option.item[1]?.label;
                    let ctx = hc2(Text, { args: [label] }, ele);
                    ctx.ele.onclick = function () {
                        globalThis.wRoute.push(name, {
                            paramA: 'from nav'
                        })
                    }
                }
            }, nav);


            let mainContent = document.createElement('div')
            mainContent.id = 'mainContent';
            mainContent.classList.add('flex-1');
            mainContent.classList.add('overflow-hidden');
            mainContent.style['overflow-y'] = 'auto';

            let swCon = document.createElement('swiper-container');

            hc2(ForEach, {
                args: [{ max: 3 }], init: (ele, option) => {
                    // console.log('ele', ele)
                    let swSlide = document.createElement('swiper-slide')
                    swSlide.innerHTML = 'slide' + option.index;
                    swSlide.style.height = '300px';
                    option.appendChild(swSlide)
                }
            }, swCon);


            mainContent.appendChild(swCon)

            rooterRootEle.appendChild(nav)
            rooterRootEle.appendChild(mainContent)
            return {
                tureRoot: mainContent
            }
        }



        routerModule(option)
    </script>
    <script>
        function __load_async_lib() {
            let asyncLib = [
                '/assets/virtualized-list.min.js',
                'https://cdn.jsdelivr.net/npm/swiper@10/swiper-element-bundle.min.js',
            ];
            asyncLib.forEach(libSrc => {
                let script = document.createElement('script');
                script.src = libSrc;
                document.body.appendChild(script)
            })
        }
        __load_async_lib()
    </script>
</body>

</html>